<!DOCTYPE html>
<!-- Note to self: Make sure to run chrome from cmd line using 
google-chrome --unsafely-treat-insecure-origin-as-secure="http://localhost:5000/"
because you can't use geolocation over http anymore
-->
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <title>Restaurant  Finder</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    </script>
</head>
<body>
    <h1>Nearby Restaurants: (in development)</h1>
    <button data-placement="top" title="Find restaurants that serve breakfast" type="button" class="btn btn-primary" id="breakfastBtn" onClick="changeRestType('breakfast')">Breakfast</button>
    <button data-placement="top" title="Find restaurants that serve lunch" type="button" class="btn btn-primary" id="lunchBtn" onClick="changeRestType('lunch')">Lunch</button>
    <button data-placement="top" title="Find restaurants that serve dinner" type="button" class="btn btn-primary" id="dinnerBtn" onClick="changeRestType('dinner')">Dinner</button>
    <div id="restTypeInfo" class="alert alert-primary" role="alert">
        This is a primary alertâ€”check it out!
      </div>
    <div id="info"></div>
    <div id="spinner" class="spinner-border"></div>
    

    <script>
    var spinner = document.getElementById("spinner");

        console.log("CALLING CHANGERESTYPE - LUNCH")
        changeRestType("lunch");
if(navigator.geolocation) {
      console.log("navigator.geolocation is available");
      navigator.geolocation.getCurrentPosition(function(position) {
        console.log("current position acquired");
      });  
    }

    function initMap() {
        var list = document.createElement('ul');

           list.className = "list-group";

         console.log(navigator.geolocation);

        //HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            $.ajax({
                type: "POST",
                url: "http://localhost:5000/postmethod",
                contentType: "application/json",
                data: JSON.stringify({location: pos}),
                dataType: "json",
                success: function(response) {
                    console.log(response);
                },
                error: function(err) {
                    console.log(err);
                }
            });


            $.ajax({
                type: "GET",
                url: "http://localhost:5000/getdata",
                contentType: "application/json",
                dataType: "json",
                success: function(response) {

                    rest = response
                    console.log(rest);
                    
                    for(var i = 0; i < 50 ; i++){  
                       var item = document.createElement('li');
                       var restID = rest[i]['id'];
                       var restName = rest[i]['name'];
                       var restLat = rest[i]['coordinates']['latitude'];
                       var restLng = rest[i]['coordinates']['longitude'];
                       var restRating = rest[i]['rating'] + " stars with " + rest[i]['review_count'] + " reviews";
                       var restLoc = rest[i]['location']['display_address'][0] + " " + rest[i]['location']['display_address'][1]
                       var restPhone = rest[i]['display_phone'];
                       var item = document.createElement('li');
                       var restDetailsDiv = document.createElement('div');
                       var restDetailsLink = document.createElement('a');
                       restDetailsLink.innerText = "View Restaurant Details";
                       restDetailsLink.className = "btn btn-info";
                       restDetailsLink.href = "http://localhost:5000/restaurant/" + restID;
                       restDetailsDiv.append(restDetailsLink);
                       item.className = "list-group-item";
                       var restFullInfo = restName + "  " + restRating + "  "  + restLoc + "  "  + restPhone+ "  ";
                       item.append(restFullInfo);
                       //item.append(restDetails)
                       item.append(restDetailsDiv);
                       list.append(item);
                       pos = {
                         lat: restLat,
                         lng: restLng
                        };
                    }
                    var spinner = document.getElementById("spinner");
                     spinner.style.visibility = 'hidden';
                     console.log(spinner.style.visibility);
                },
                error: function(err) {
                    console.log(err);
                }
            });
            }, function() {
            });
        } else {
            console.log("Geolocation failed");
        }

return list;
    }

function changeRestType(type){
    spinner.style.visibility = "visible";
    console.log(spinner.style.visibility);

//alert(type);
r = {
                type
            };

$.ajax({
            type: "POST",
            url: "http://localhost:5000/rest",
            contentType: "application/json",
            data: JSON.stringify({restType: type}),
            dataType: "json",
             success: function(response) {
                console.log(response);

            },
            error: function(err) {
                console.log(err);

            }
        });

var displayData2 = initMap();
document.getElementById('info').innerHTML = "";
document.getElementById('info').appendChild(displayData2);
document.getElementById('restTypeInfo').innerHTML = "Currently displaying 50 restaurants that serve " + type;

}
    </script>
</body>
</html>